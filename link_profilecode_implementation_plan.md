# link.profilecode.codes å®Ÿè£…è¨ˆç”»

ç¾åœ¨ã®çŠ¶æ³ã¨å®Ÿè£…è¨ˆç”»ã‚’ã¾ã¨ã‚ãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã™ã€‚

---

## ğŸ“Š ç¾åœ¨ã®çŠ¶æ³

### ç¢ºèªã•ã‚ŒãŸäº‹å®Ÿ

1. **ã‚¢ãƒ—ãƒªå´ã®è¨­å®š**
   - ã‚¢ãƒ—ãƒªã¯ `link.profilecode.codes/join` ã‚’å‡¦ç†ã™ã‚‹ã‚ˆã†ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹
   - ãƒ†ã‚¹ãƒˆã‚¢ãƒ—ãƒªã§ `/join` å‡¦ç†ãŒå‹•ä½œã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªæ¸ˆã¿

2. **ã‚¦ã‚§ãƒ–å´ã®ç¾çŠ¶**
   - `profilecode.codes/join` â†’ ãƒ¡ã‚¤ãƒ³ãƒ‰ãƒ¡ã‚¤ãƒ³ã§å‡¦ç†ã•ã‚Œã¦ã„ã‚‹ï¼ˆå‹•ä½œä¸­ï¼‰
   - `link.profilecode.codes/join` â†’ **æœªå®Ÿè£…**ï¼ˆå‡¦ç†ã§ãã¦ã„ãªã„ï¼‰

3. **å•é¡Œç‚¹**
   - ã‚¢ãƒ—ãƒªå´ã¯ `link.profilecode.codes/join` ã‚’æœŸå¾…ã—ã¦ã„ã‚‹
   - å®Ÿéš›ã«ã¯ `profilecode.codes/join` ã§å‡¦ç†ã•ã‚Œã¦ã„ã‚‹
   - `link.profilecode.codes` ãŒæœªå®Ÿè£…ã®ãŸã‚ã€ã‚¢ãƒ—ãƒªã¨ã‚¦ã‚§ãƒ–ã§ä¸ä¸€è‡´

---

## ğŸ¯ å®Ÿè£…ç›®æ¨™

### æœ€çµ‚çš„ãªæ§‹æˆ

```
profilecode.codes/
â”œâ”€â”€ /                          # ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒšãƒ¼ã‚¸ï¼ˆãƒ¡ã‚¤ãƒ³ï¼‰
â”œâ”€â”€ /join                       # link.profilecode.codes/join ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
â”œâ”€â”€ /test                       # ã‚¦ã‚§ãƒ–è¨ºæ–­ã®å…¥ã‚Šå£
â”œâ”€â”€ /privacy-policy.html        # ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ï¼ˆæ—¢å­˜ï¼‰
â””â”€â”€ /eula.html                  # åˆ©ç”¨è¦ç´„ï¼ˆæ—¢å­˜ï¼‰

link.profilecode.codes/
â””â”€â”€ /join?token=...             # ãƒ‡ã‚£ãƒ¼ãƒ—ãƒªãƒ³ã‚¯å‡¦ç†å°‚ç”¨
```

---

## ğŸ“‹ å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—

### ã‚¹ãƒ†ãƒƒãƒ—1: `link.profilecode.codes` ã®å®Ÿè£…ï¼ˆæœ€å„ªå…ˆï¼‰

**ç›®çš„**: ã‚¢ãƒ—ãƒªå´ãŒæœŸå¾…ã™ã‚‹ `link.profilecode.codes/join` ã‚’å®Ÿè£…ã™ã‚‹

**å¿…è¦ãªä½œæ¥­**:
1. `link.profilecode.codes` ç”¨ã®ãƒªãƒã‚¸ãƒˆãƒª/ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
2. `/join` å‡¦ç†ã‚’å®Ÿè£…
3. `apple-app-site-association` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®
4. `assetlinks.json` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

**å®Ÿè£…å†…å®¹**:
- `index.html` ã§ `/join` ãƒ‘ã‚¹ã‚’å‡¦ç†
- `token` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–å¾—
- Android/iOSãã‚Œãã‚Œã§ã‚¢ãƒ—ãƒªèµ·å‹•å‡¦ç†
- ã‚¢ãƒ—ãƒªæœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†

**å¿…é ˆä¿®æ­£é …ç›®**:
1. ãƒ‘ã‚¹åˆ¤å®š: `path.startsWith("/join")` ã‚’ä½¿ç”¨
2. ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚­ãƒ¼ãƒ : `com.profilecode.profilecode://` ã‚’ä½¿ç”¨
3. `apple-app-site-association`: æ­£ã—ã„ `paths` ã‚’è¨­å®š

---

### ã‚¹ãƒ†ãƒƒãƒ—2: `profilecode.codes/join` ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå®Ÿè£…

**ç›®çš„**: æ—¢å­˜ã® `/join` ã‚¢ã‚¯ã‚»ã‚¹ã‚’ `link.profilecode.codes/join` ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

**å¿…è¦ãªä½œæ¥­**:
1. `profilecode.codes` å´ã§ `join.html` ã‚’ä½œæˆ
2. `index.html` ã‹ã‚‰ `/join` å‡¦ç†ã‚’å‰Šé™¤
3. `index.html` ã‚’ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒšãƒ¼ã‚¸ã«å¤‰æ›´

**å®Ÿè£…å†…å®¹**:

#### `join.html` ã®ä½œæˆ

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirecting...</title>
    <script>
        // /joinã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’link.profilecode.codesã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
        window.onload = function() {
            const currentUrl = new URL(window.location.href);
            const queryString = currentUrl.search;
            const hash = currentUrl.hash;
            
            // link.profilecode.codes/joinã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆï¼ˆã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ãƒãƒƒã‚·ãƒ¥ã‚’ä¿æŒï¼‰
            window.location.href = `https://link.profilecode.codes/join${queryString}${hash}`;
        };
    </script>
</head>
<body>
    <p>ã‚¢ãƒ—ãƒªã‚’é–‹ã„ã¦ã„ã¾ã™...</p>
</body>
</html>
```

#### `_config.yml` ã®è¨­å®š

```yaml
redirect_from:
  - /join
  - /join/
```

ã¾ãŸã¯ã€`join.html` ã‚’é…ç½®ã—ã¦è‡ªå‹•çš„ã« `/join` ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã«ã™ã‚‹ã€‚

---

### ã‚¹ãƒ†ãƒƒãƒ—3: `index.html` ã®ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒšãƒ¼ã‚¸åŒ–

**ç›®çš„**: ãƒ¡ã‚¤ãƒ³ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒšãƒ¼ã‚¸ã«å¤‰æ›´

**å¿…è¦ãªä½œæ¥­**:
1. `index.html` ã‹ã‚‰ `/join` å‡¦ç†ã‚’å‰Šé™¤
2. ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒšãƒ¼ã‚¸ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¿½åŠ 
3. ã‚¢ãƒ—ãƒªãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã‚’è¿½åŠ 
4. ã‚¦ã‚§ãƒ–è¨ºæ–­ã¸ã®å°ç·šã‚’è¿½åŠ 

**å‰Šé™¤ã™ã‚‹ã‚³ãƒ¼ãƒ‰**:
```javascript
// å‰Šé™¤å¯¾è±¡
if (path === "/join" && token) {
    // Sharelinkã®å ´åˆ
    window.location.href = `intent://join?token=${token}...`;
}
```

---

## ğŸ”§ `link.profilecode.codes` ã®å®Ÿè£…è©³ç´°

### å¿…é ˆå®Ÿè£…é …ç›®

#### 1. `index.html` ã®å®Ÿè£…

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Opening Profilecode...</title>
    <script>
        (function() {
            const path = window.location.pathname;
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get("token");
            
            // apple-app-site-associationãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯ç‰¹åˆ¥å‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ—
            if (path === '/.well-known/apple-app-site-association') {
                return;
            }
            
            // /joinã§å§‹ã¾ã‚‹ãƒ‘ã‚¹ã‚’å‡¦ç†
            if (path.startsWith("/join") && token) {
                const isAndroid = /Android/i.test(navigator.userAgent);
                const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
                
                const playStoreLink = 'https://play.google.com/store/apps/details?id=com.profilecode.profilecode';
                const appStoreLink = 'https://apps.apple.com/app/YOUR_APP_ID';
                
                if (isAndroid) {
                    // Android Intentã‚¹ã‚­ãƒ¼ãƒ 
                    window.location.href = `intent://join?token=${token}#Intent;scheme=https;package=com.profilecode.profilecode;S.browser_fallback_url=${encodeURIComponent(playStoreLink)};end`;
                } else if (isIOS) {
                    // iOS Universal Links â†’ ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚­ãƒ¼ãƒ  â†’ App Store
                    const universalLink = `https://link.profilecode.codes/join?token=${token}`;
                    const customScheme = `com.profilecode.profilecode://join?token=${token}`;
                    
                    let appLaunched = false;
                    let customSchemeTimeout;
                    let appStoreTimeout;
                    
                    // ã‚¢ãƒ—ãƒªãŒèµ·å‹•ã—ãŸã“ã¨ã‚’æ¤œçŸ¥ã™ã‚‹é–¢æ•°
                    function detectAppLaunch() {
                        appLaunched = true;
                        // ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¯ãƒªã‚¢
                        if (customSchemeTimeout) {
                            clearTimeout(customSchemeTimeout);
                        }
                        if (appStoreTimeout) {
                            clearTimeout(appStoreTimeout);
                        }
                    }
                    
                    // ãƒšãƒ¼ã‚¸ãŒéè¡¨ç¤ºã«ãªã£ãŸã‚‰ã‚¢ãƒ—ãƒªãŒèµ·å‹•ã—ãŸã¨åˆ¤æ–­
                    document.addEventListener('visibilitychange', function() {
                        if (document.hidden) {
                            detectAppLaunch();
                        }
                    });
                    
                    // ãƒšãƒ¼ã‚¸ãŒã‚¢ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹å‰ã«ã‚¢ãƒ—ãƒªãŒèµ·å‹•ã—ãŸã¨åˆ¤æ–­
                    window.addEventListener('pagehide', function() {
                        detectAppLaunch();
                    });
                    
                    // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’å¤±ã£ãŸã‚‰ã‚¢ãƒ—ãƒªãŒèµ·å‹•ã—ãŸã¨åˆ¤æ–­
                    window.addEventListener('blur', function() {
                        detectAppLaunch();
                    });
                    
                    // ã¾ãšUniversal Linksã‚’è©¦ã™
                    window.location.href = universalLink;
                    
                    // 3ç§’å¾Œã«ã‚¢ãƒ—ãƒªãŒèµ·å‹•ã—ã¦ã„ãªã‘ã‚Œã°ã‚«ã‚¹ã‚¿ãƒ URLã‚¹ã‚­ãƒ¼ãƒ ã‚’è©¦ã™
                    customSchemeTimeout = setTimeout(function() {
                        if (!appLaunched) {
                            window.location.href = customScheme;
                            
                            // ã•ã‚‰ã«3ç§’å¾Œã«ã‚¢ãƒ—ãƒªãŒèµ·å‹•ã—ã¦ã„ãªã‘ã‚Œã°App Storeã«é·ç§»
                            appStoreTimeout = setTimeout(function() {
                                if (!appLaunched) {
                                    window.location.href = appStoreLink;
                                }
                            }, 3000);
                        }
                    }, 3000);
                } else {
                    // ãã®ä»–ã®ãƒ‡ãƒã‚¤ã‚¹
                    window.location.href = playStoreLink;
                }
            }
        })();
    </script>
</head>
<body>
    <p>ã‚¢ãƒ—ãƒªã‚’é–‹ã„ã¦ã„ã¾ã™...</p>
</body>
</html>
```

#### 2. `.well-known/apple-app-site-association` ã®é…ç½®

```json
{
    "applinks": {
        "apps": [],
        "details": [
            {
                "appID": "J4SJR8W4AS.com.profilecode.profilecode",
                "paths": [
                    "/join*",
                    "/auth/callback*",
                    "/reset-password*",
                    "/login-callback*"
                ]
            }
        ]
    }
}
```

#### 3. `_config.yml` ã®è¨­å®šï¼ˆGitHub Pagesä½¿ç”¨æ™‚ï¼‰

```yaml
include:
  - .well-known
```

---

## ğŸ“‹ å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### `link.profilecode.codes` ã®å®Ÿè£…

- [ ] ãƒªãƒã‚¸ãƒˆãƒª/ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
- [ ] `index.html` ã‚’å®Ÿè£…ï¼ˆãƒ‘ã‚¹åˆ¤å®š: `path.startsWith("/join")`ï¼‰
- [ ] ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚­ãƒ¼ãƒ : `com.profilecode.profilecode://` ã‚’ä½¿ç”¨
- [ ] `.well-known/apple-app-site-association` ã‚’é…ç½®
- [ ] `_config.yml` ã§ `.well-known` ã‚’ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰
- [ ] ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦å‹•ä½œç¢ºèª

### `profilecode.codes` ã®ä¿®æ­£

- [ ] `join.html` ã‚’ä½œæˆï¼ˆãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå‡¦ç†ï¼‰
- [ ] `index.html` ã‹ã‚‰ `/join` å‡¦ç†ã‚’å‰Šé™¤
- [ ] `index.html` ã‚’ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒšãƒ¼ã‚¸ã«å¤‰æ›´
- [ ] `_config.yml` ã§ `redirect_from: /join` ã‚’è¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- [ ] ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦å‹•ä½œç¢ºèª

### å‹•ä½œç¢ºèª

- [ ] `link.profilecode.codes/join?token=test123` ã§ã‚¢ãƒ—ãƒªãŒèµ·å‹•ã™ã‚‹
- [ ] `profilecode.codes/join?token=test123` ãŒ `link.profilecode.codes/join?token=test123` ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã‚‹
- [ ] `profilecode.codes/` ãŒãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒšãƒ¼ã‚¸ã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã‚‹
- [ ] iOSå®Ÿæ©Ÿãƒ†ã‚¹ãƒˆã§å‹•ä½œç¢ºèª
- [ ] Androidå®Ÿæ©Ÿãƒ†ã‚¹ãƒˆã§å‹•ä½œç¢ºèª

---

## ğŸ¯ å®Ÿè£…å„ªå…ˆé †ä½

### ãƒ•ã‚§ãƒ¼ã‚º1: ç·Šæ€¥å¯¾å¿œï¼ˆå³åº§ã«å®Ÿè£…ï¼‰

1. **`link.profilecode.codes` ã®å®Ÿè£…**
   - ã‚¢ãƒ—ãƒªå´ãŒæœŸå¾…ã™ã‚‹URLã‚’å®Ÿè£…
   - æ‰€è¦æ™‚é–“: ç´„1æ™‚é–“

### ãƒ•ã‚§ãƒ¼ã‚º2: ç§»è¡Œå¯¾å¿œï¼ˆæ—©æœŸã«å®Ÿè£…ï¼‰

2. **`profilecode.codes/join` ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ**
   - æ—¢å­˜ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’æ–°ã—ã„URLã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
   - æ‰€è¦æ™‚é–“: ç´„30åˆ†

3. **`profilecode.codes` ã®ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒšãƒ¼ã‚¸åŒ–**
   - ãƒ¡ã‚¤ãƒ³ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’æ•´ç†
   - æ‰€è¦æ™‚é–“: ç´„1æ™‚é–“

---

## âš ï¸ æ³¨æ„äº‹é …

### å®Ÿè£…æ™‚ã®æ³¨æ„ç‚¹

1. **ãƒ‘ã‚¹åˆ¤å®š**: `path.startsWith("/join")` ã‚’ä½¿ç”¨ï¼ˆå³å¯†ä¸€è‡´ã§ã¯ãªã„ï¼‰
2. **ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚­ãƒ¼ãƒ **: `com.profilecode.profilecode://` ã‚’ä½¿ç”¨ï¼ˆ`profilecode://` ã§ã¯ãªã„ï¼‰
3. **apple-app-site-association**: æ­£ã—ã„ `paths` ã‚’è¨­å®šï¼ˆ`["*"]` ã§ã¯ãªã„ï¼‰

### ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã®ç¢ºèª

1. `link.profilecode.codes/join?token=test123` ã§ã‚¢ãƒ—ãƒªãŒèµ·å‹•ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
2. `profilecode.codes/join?token=test123` ãŒæ­£ã—ããƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
3. å®Ÿæ©Ÿãƒ†ã‚¹ãƒˆã§å‹•ä½œç¢ºèª

---

## ğŸ”— å‚è€ƒæƒ…å ±

- ã‚¢ãƒ—ãƒªå´ã®å®Ÿè£…: `lib/deep_link/deep_link_handler.dart`
- iOSè¨­å®š: `ios/Runner/Info.plist`, `apple-app-site-association`
- Androidè¨­å®š: `android/app/src/main/AndroidManifest.xml`
- ä¿®æ­£è¦æœ›: `docs/link_profilecode_fix_requirements_final.md`
- ç¢ºèªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ: `docs/link_profilecode_verification_checklist.md`

---

**æœ€çµ‚æ›´æ–°**: 2024å¹´
**ä½œæˆè€…**: profilecodeé–‹ç™ºãƒãƒ¼ãƒ 

